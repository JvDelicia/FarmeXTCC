@{
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Profile</title>
</head>
<body>
    <center>
        <div class="container" width="80%">
            <ul class="nav nav-tabs justify-content-end" id="TabProfile" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="activity-tab" data-toggle="tab" href="#activity" role="tab" aria-controls="activity" aria-selected="true">Activity</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="settings-tab" data-toggle="tab" href="#settings" role="tab" aria-controls="settings" aria-selected="false">Settings</a>
                </li>
                @if(Session["DevId"] == null)
                {
                    <li class="nav-item">
                    <a class="nav-link" id="upgrade-tab" data-toggle="tab" href="#upgrade" role="tab" aria-controls="upgrade" aria-selected="false">Upgrade to Developer</a>
                </li>
                }                
                @if(Session["DevId"] != null)
                {
                    <li class="nav-item">
                        <a class=" btn btn-outline-danger" href="../Developer/ProfileView">Developer Profile</a>
                    </li>
                }
                @if(Session["ModId"] != null)
                {
                    <li class="nav-item">
                        <a class="btn btn-outline-danger" href="../Moderator/ProfileView" >Moderator Profile</a>
                    </li>
                }
                <li class="nav-item">
                    <a class="btn btn-outline-danger" href="/User/Logout">Logout</a>
                </li>
            </ul>
            @* Tab Content  *@
            <div class="tab-content" id="TabProfileContent">
                <div class="tab-pane fade show active" id="activity" role="tabpanel" aria-labelledby="activity-tab">Alooooo</div>

                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">Disney</div>

                <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                    <center>
                        <br />
                        <form role="form" id="Update" class="needs-validation"  method="post" @*action="/User/Update"*@ enctype="multipart/form-data" onsubmit="return AjaxPostUpdateProfile(this)">
                            <div class="form-row">
                                <div class="col">
                                    <label for="Name">Name</label>
                                    <input type="text" class="form-control" id="Name" value="@ViewBag.User.Name" placeholder="Name" required name="user.Name" />
                                    <div class="invalid-tooltip">
                                        Please choose a valid Name.
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="Email">Email</label>
                                    <input type="email" class="form-control" id="Email" value="@ViewBag.User.Email" placeholder="Email" required name="user.Email" />
                                    <div class="invalid-tooltip">
                                        Please choose a valid Email.
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="Country">Country</label><br />
                                    <select class="custom-select" required id="user.CountryId" name="user.CountryId">
                                        @foreach (var c in ViewBag.Country)
                    {
                        <option value="@c.Id" selected="@c.Id.Equals(ViewBag.User.CountryId)"> @c.Name</option>
}
                                    </select>
                                    <div class="invalid-tooltip">
                                        Please choose a valid Country.
                                    </div>
                                </div>
                                <div class="col">
                                    <label for="Language">Language</label><br />
                                    <select class="custom-select" required id="user.LanguageId" name="user.LanguageId">
                                        @foreach (var l in ViewBag.Lang)
                    {
                        <option value="@l.Id" selected="@l.Id.Equals(ViewBag.User.LanguageId)"> @l.Name</option>
}
                                    </select>
                                    <div class="invalid-tooltip">
                                        Please choose a valid Country.
                                    </div>
                                </div>
                            </div>
                            <br /><br />
                            <input type="submit" value="Update" class="btn btn-danger" />
                        </form>
                        <br />
                        <div class="@ViewBag.Class" style="width:80%;" role="alert">
                            @Html.ValidationMessage("User.Name")<br />
                            @Html.ValidationMessage("User.Email")<br />
                            @Html.ValidationMessage("User.CountryId")<br />
                            @Html.ValidationMessage("User.LanguageId")<br />
                        </div>
                        <br />
                        <hr />
                        <br /><br />
                        <h2>Change Password</h2>
                        <form class="needs-validation" method="post" action="/User/ChangePassword">
                            <div class="form-row">
                                <div class="col">
                                    <label for="Password">Password</label>
                                    <input type="password" class="form-control" id="Password" placeholder="Password" required name="psw" />
                                    <div class="invalid-tooltip">
                                        Please choose a valid Password.
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="Confirm">Confirm Password</label>
                                    <input type="password" class="form-control" id="ConfirmPassword" placeholder="Confirm Password" required name="cpsw" />
                                    <div class="invalid-tooltip">
                                        Please choose a valid Password.
                                    </div>
                                </div>
                            </div>
                            <input type="submit" value="Change Password" class="btn btn-danger" />
                            <br />
                            @Html.ValidationMessage("User.Password4")<br />@Html.ValidationMessage("User.PasswordDM")<br />
                        </form>
                    </center>

                </div>

                <div class="tab-pane fade" id="upgrade" role="tabpanel" aria-labelledby="upgrade-tab">
                    <br />
                    <a href="../Developer/Register" class="btn btn-outline-danger">Upgrade to Developer</a>
                    <br />
                    <br />
                    <a href="../Moderator/Register" class="btn btn-outline-danger">Upgrade to Moderator</a>
                </div>
            </div>
        </div>
    </center>


    <script>
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>

    @*<script>  
        $('#Update').validator().on('submit', function (e) {
            if (e.isDefaultPrevented()) {
                alert('form is not valid');
            } else {
                e.preventDefault();
                alert('form is valid');
                //Ajax

                

            }
        });
            
        
    </script>*@

    <script>
        function AjaxPostUpdateProfile(formData) {
            var ajaxConfig = {
                type: "post",
                url: "/User/Update",
                data: new FormData(formData),
                success: function (result) {
                    alert(result);
                    window.location.href = "/User/Profile";
                }
            }
            if ($(formData).attr('enctype') == "multipart/form-data") {
                ajaxConfig["contentType"] = false;
                ajaxConfig["processData"] = false;
            }
            $.ajax(ajaxConfig);
            return false;
        }
    </script>

    @*<script>
        function AjaxPostChangePass(formData) {
            var ajaxConfig = {
                type: "post",
                url: "/User/ChangePassword",
                data: new FormData(formData),
                success: function (result) {
                    if (!(result == "Error")) {
                        alert(result);
                        window.location.href = "/User/Profile";
                    }
                }
            }
            if ($(formData).attr('enctype') == "multipart/form-data") {
                ajaxConfig["contentType"] = false;
                ajaxConfig["processData"] = false;
            }
            $.ajax(ajaxConfig);
            return false;
        }
    </script>*@

</body>
</html>
